%% fig:DentBazi76
%% bib:DentBazi76
%% out:DentBazi76a,DentBazi76b,DentBazi76c,DentBazi76d,DentBazi76e 

%% glucose mg/ml

dat_glu =[ ...
25 0.009556873021;
26 0.09264987218 ;
27 0.1501772971 ;
28 0.1983964473 ;
29 0.245779088 ;
29.5 0.2660485474 ;
30 0.2753210727 ;
31 0.3110560089;
32 0.3444671558 ;
32.5 0.367711175 ;
33 0.387376785 ;
34 0.4017328742 ;
35 0.4273721817 ;
35.5 0.4541968444 ;
36 0.4652474026 ;
37 0.4769152162 ;
38 0.4933557316 ;
39 0.4940444859 ;
40 0.5188227062 ;
40.5 0.451320307 ;
41 0.5188696274 ;
42 0.4972469486 ;
43 0.4907855876 ;
44 0.4759909903 ;
45 0.4329157312 ;
46 0.3339008724 ;
46.5 0.3250419888 ;
47 0.2192213918 ;
49 0.1381231567 ;
50 0.1072480616 ;
51 0.04904946844 ;
52 0.008669187914 ;
53 0.005461967989 ;
55 0.003218614936 ;
57 0.006626925574 ;
58 0.004041429711 ;
60 0.01461326171 ;
62 0.007308688253 ;
64 0.004202013685 ;
66 0.004637998826 ;
68 0.009842217072 ;
69 0.007540771146 ;
70 0.003807903833 ;
77 0.03020941027 ;
78 0.00677071477 ;
79 0.1038218018 ;
81 0.1604948426 ;
82 0.1748531661 ;
83 0.2028899961 ;
84 0.2196190301 ;
85 0.2226539172 ;
87 0.2097267265 ;
89 0.1533553218 ;
90 0.104655211 ;
91 0.078230784 ;
91.5 0.07351394074; 
93 0.0370274001 ;
95 0.02348742269 ;
97 0.007599078181 ;
101 0.001327636171 ;
103 0.00266716097 ;
105 0.002830267882 ;
107 0.002966562698 ;
109 0 ;
111 0.00003640108902 ;
113 0 ;
114 0 ;
117 0 ;
118 0.0008589272674 ;
120 0.007830006686 ;
122 0.004736738165 ;
124 0.01441843656 ;
126 0.003861956347 ;
128 0.003698560839 ;
130 0 ;
132 0 ;
134 0.00001232609435];


%% E.coli mm^3/ml

dat_coli = [ ...
1 0.424038209 ;
2 0.6442117914 ;
2.5 0.332769832 ;
3 0.289984981 ;
3.5 0.2739072906 ;
3.7 0.4441612005 ;
4 0.5410606755 ;
4.5 0.6964204809 ;
5 0.7399286157 ;
6 0.8756119467 ;
7 0.7329171166 ;
7.5 0.3250180553 ;
8 0.6813447131 ;
8.5 0.3512153412 ;
8.7 0.1154760294 ;
9 0.6816308694 ;
9.5 0.4786873831 ;
10 0.2561067576 ;
11 0.5218423668 ;
12 0.4164338352 ;
12.5 0.5859811705 ;
13 0.3829911968 ;
15 0.4408820217 ;
18 0.6710766692 ;
21 0.701772863 ;
23 0.1265713661 ;
25 0.03526290939 ;
25.5 0.02325361179 ;
26 0.01412574195 ;
27 0.01375624453 ;
27.5 0.009201274987 ;
28 0.01143523103 ;
29 0.002696366633 ;
30 0.009091052607 ;
31 0.001165376596 ;
32 0.002444511334 ;
34 0.0007174841097 ;
38 0.00244357799 ;
38.5 0.002930690167 ;
40 0.009541263538 ;
41 0.01121843708 ;
42 0.01286214957 ;
43 0.01663540013 ;
43.5 0.02380616706 ;
44 0.03161575891 ;
44.5 0.04123007386 ;
45 0.0354328683 ;
45.5 0.0582595141 ;
46 0.07580030529 ;
46.5 0.08775849151 ;
47 0.1561140621 ;
48 0.2653276129 ;
49 0.3236143879 ;
50 0.4046591358 ;
51 0.5329289752 ;
54 0.4257178384 ;
56 0.9915612488 ;
56.5 0.8461201214 ;
57 0.9430170712 ;
58 0.7207157375 ;
60 0.9967619588 ;
64 0.7322809 ;
65 0.8698832407; 
67 0.9097848342; 
67.5 0.6723098428;
69 0.4900441658; 
70 0.7296501985 ;
72 0.7156463179 ;
75 0.6931186147 ;
75.5 0.9638908579 ;
77 0.9419128395 ;
78 0.1500869727 ;
79 0.1196430858 ;
80 0.02691935739 ;
81 0.04455832808 ;
84 0.04755061688 ;
84.5 0.0246528797 ;
86 0.02728174308 ;
87 0.03663748749 ;
88 0.04181539799 ;
88.5 0.05590066145 ;
88.7 0.0684846399 ;
90 0.103854581 ;
90.5 0.1032642124 ;
92 0.1882006185 ;
93 0.2188842527 ;
94 0.244556815 ;
96 0.3209830237 ;
97 0.2511812215 ;
99 0.3405414637 ;
100 0.3484603421 ;
101 0.1955104747 ;
102 0.2339907251 ;
104 0.3001558552 ;
106 0.3912806656 ;
108 0.3967378678 ;
110 0.4957922686 ;
112 0.4213862138 ;
114 0.3727889704 ;
116 0.3135607914 ;
118 0.2025999305 ;
120 0.09490651093 ;
121 0.0765411489 ;
124 0.09085345857 ;
126 0.0780526181 ;
128 0.1120952888 ;
130 0.09079668626 ;
132 0.2044121289 ;
134 0.1909551489 ;
136 0.1911233627 ;
138 0.1930948206 ;
140 0.2674251191 ;
142 0.3370417994 ;
144 0.2087197812 ;
146 0.09884477177 ;
149 0.150377242];

%% D.discoideum mm^3/ml

dat_disco=[ ...
2 0.06971630575;
3 0.07581290142 ;
4 0.06848787091 ;
5 0.09204353322 ;
5.5 0.1191758195 ;
7 0.1229227757 ;
8 0.1177856664 ;
9 0.1523634198 ;
11 0.1636050357 ;
12 0.2174702957 ;
13 0.2850724836 ;
16 0.382732776 ;
17 0.5399985685 ;
19 0.7775179571 ;
21 0.7922442317 ;
24 0.5414454763 ;
26 0.3357509467 ;
27 0.1559966806 ;
28 0.1922908712 ;
29 0.1660825212 ;
30 0.1250696204 ;
33 0.1157334289 ;
35 0.1013489902 ;
36 0.08495764375 ;
41 0.03673579717 ;
43 0.0328703627 ;
45 0.03330233813 ;
48 0.0467914519 ;
51 0.06045096256 ;
54 0.07748134903 ;
56 0.1134439588 ;
58 0.1107672781 ;
60 0.1374092547 ;
67 0.3090125334 ;
70 0.4129899962 ;
72 0.4493869642 ;
76 0.7562137103 ;
78 0.6777759502 ;
80 0.443467964 ;
83 0.2530485683 ;
88 0.1743931697 ;
92 0.1762791968 ;
96 0.1986722029 ;
99 0.2352799199 ;
106 0.317592696 ;
110 0.3319365539 ;
114 0.5087494075 ;
118 0.4448985449 ;
121 0.38405149 ;
124 0.4221792686; 
128 0.3393800563 ;
132 0.2983131948 ;
140 0.2789025625 ;
144 0.2701362744];

%% mean cell volume E.coli

vol_coli=[ ...
0.76706 0.47821 1;
1.7765 0.44788 1 ;
2.7128 0.42982 1 ;
4.1946 0.4181  1 ;
4.9908 0.41841 1 ;
5.8813 0.38435 1 ;
6.5797 0.35882 1 ;
9.0167 0.37327 1 ;
9.4325 0.38695 1 ;
10.564 0.35667 1 ;
40.436 1.6017  1 ;
42.082 1.6097  1 ;
43.46 1.5144   1 ;
48.54 0.81728  1 ;
54.272 0.39809 1 ;
64.974 0.35552 1 ;
84.095 0.60738 1 ;
88.759 1.2382  1 ;
91.983 0.7517  1 ;
94.335 0.66292 1 ;
99.38 0.57764  1 ;
100.17 0.52511 1 ;
107.17 0.43567 1 ;
111.69 0.39318 1 ;
115.23 0.47318 1 ;
124.48 0.78634 1 ;
135.16 0.57669 1 ;
144.72 0.51403 1];

%% mean cell volume D.discoideum

vol_disco=[ ...
0.30905 232.32 1 ;
1.0128 257.16 1 ;
2.8276 279.81 1 ;
3.4333 265.32 1 ;
4.3138 275.65 1 ;
5.5712 283.49 1 ;
6.3208 296.05 1 ;
7.7673 286.13 1 ;
8.3161 368.8  1 ;
10.469 333.88 1 ;
12.132 331.48 1 ;
12.766 407.89 1 ;
15.257 397.03 1 ;
16.802 409.9  1 ;
18.292 486.62 1 ;
20.02  417.86 1 ;
24.265 265.62 1 ;
25.503 196.83 1 ;
26.799 161.61 1 ;
27.614 156.65 1 ;
28.773 141.7  1 ;
30.155 148.79 1 ;
33.018 153.48 1 ;
34.605 138.55 1 ;
35.746 128.61 1 ;
40.226 110.36 1 ;
42.717 132.3  1 ;
44.62  131.42 1 ;
47.487 151.13 1 ;
51.367 211.47 1 ;
53.327 260.92 1 ;
55.294 275.57 1 ;
57.493 277.46 1 ;
59.879 294.89 1 ;
67.528 281.09 1 ;
68.977 303.47 1 ;
72.146 324.45 1 ;
76.066 341.23 1 ;
77.028 280.68 1 ;
78.887 291.32 1 ;
82.708 187.13 1 ;
87.657 158.14 1 ;
91.761 174.93 1 ;
95.95  185.46 1 ;
97.927 279.23 1 ;
105.47 358.84 1 ;
109.76 327.05 1 ;
113.13 359.32 1 ;
117.9  295.26 1 ;
120.35 197.25 1 ;
122.79 398.98 1 ;
127.45 315.13 1 ;
131.12 284.06 1 ;
139.1  280.8 1 ;
142.86 258 1];

Kcoli = .0004;  Kdisco = .18; % half saturation constant
jcoli = .65;    jdisco = .26; % max spex ingestion rate
gcoli = .86;    gdisco = 4.43; % investment ratio
kMcoli = .0083; kMdisco = .16; % maint rate coefficient
kEcoli = .67;   kEdisco = 2.05; % reserve turnover rate
wcoli = 2.2;      wdisco = 3; % contrib of reserve in volume
glu0 = .58;     % mg/l, initial glucose concentration
coli0 = .46;    disco0 = .07; % intial boimass density
ecoli0 = 1;     edisco0 = 1; % initial scaled reserve density
D = .064;       xr = 1; % 1/h, mg/l throughput rate, glucose conc in the feed
Vcoli = .35;     Vdisco = 100; % mum^3, mean structural cell volume

%% pack parameters
par = [Kcoli 1; Kdisco 1;
       jcoli 1; jdisco 1;
       gcoli 1; gdisco 1;
       kMcoli 1; kMdisco 1;
       kEcoli 1; kEdisco 1;
       wcoli 0; wdisco 0;
       glu0 0;
       coli0 0; disco0 0;
       ecoli0 0; edisco0 0;
       D 0; xr 0;
       Vcoli 1; Vdisco 1];

par_txt = {'saturation coeff E. coli'; 'saturation coeff D. disc'; ...
    	   'max spec uptake E. coli'; 'max spec uptake D. disc'; ...
           'investm. ratio E. coli'; 'investm. ratio D. disc'; ...
           'maint rate coeff E. coli'; 'maint rate coeff D. disc'; ...
           'reserve turnover E. coli'; 'reserve turnover D. disc'; ...
           'res contr in vol E. coli'; 'res contr in vol D. disc'; ...
           'initial glucose conc'; ...
           'initial vol E. coli'; 'initial vol D. disc'; ...
           'initial res E. coli'; 'initial res D. disc'; ...
           'throughput rate'; 'conc glucose in feed'; ...
    	   'struc cell vol E. coli'; 'struc cell vol D. disc'};

  nmregr_options('max_step_number',100);
  %% par = nmregr('gcd', par, dat_glu, dat_coli, dat_disco, vol_coli, vol_disco);
  [cov, cor, sd, ssq] = pregr('gcd', par, dat_glu, dat_coli, dat_disco, ...
			   vol_coli, vol_disco);
  printpar(par_txt,par,sd);

  t = linspace(1e-3, 150, 100)';
  [glu, coli, disco, vcoli, vdisco] = gcd(par(:,1), t, t, t, t, t);

  subplot(3,2,1)
  plot(dat_glu(:,1), dat_glu(:,2), '.r', t, glu, '-r');
  xlabel('time, h')
  ylabel('glucose, mg/ml')

  subplot(3,2,3)
  plot(dat_coli(:,1), dat_coli(:,2), '.g', t, coli, '-g')
  xlabel('time, h')
  ylabel('vol E. coli, mm^3/ml')

  subplot(3,2,4)
  plot(vol_coli(:,1), vol_coli(:,2), '.g', t, vcoli, '-g')
  xlabel('time, h')
  ylabel('mean cell vol E. coli, mum^3')

  subplot(3,2,5)
  plot(dat_disco(:,1), dat_disco(:,2), '.b', t, disco, '-b')
  xlabel('time, h')
  ylabel('vol D. disc, mm^3/ml')

  subplot(3,2,6)
  plot(vol_disco(:,1), vol_disco(:,2), '.b', t, vdisco, '-b')
  xlabel('time, h')
  ylabel('mean cell vol D. disc, mum^3')
