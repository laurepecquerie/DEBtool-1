%% fig:daph
%% bib:EverKooy89,KooyBeda96b
%% out:respldap,ildaph,rep0,ladaph

%% \kappa-rule motivation figures

length_ing = [...
          0.6581788502 0.6923650756;...
	      1.021592306 0.5450395978;...
	      1.151867194 0.6381083757;...
	      1.217525399 0.7237877094;...
	      1.228410757 0.5984383666;...
	      1.270883144 0.6098935363;...
	      1.235619235 0.4829011988;...
	      1.258633088 0.443595905;...
	      1.314729962 0.3101088229;...
	      1.193817756 0.3050603631;...
	      1.364232095 0.6973416286;...
	      1.239615488 1.293247774;...
	      1.487600926 1.105602828;...
	      1.571622774 1.128519455;...
	      1.619855087 1.286742229;...
	      1.587866956 1.494447187;...
	      1.738562686 1.054957327;...
	      1.64213957 0.7659154419;...
	      1.68723249 0.6794815248;...
	      2.328616974 1.861310899;...
	      1.711530604 3.315966971;...
	      2.341576483 1.886669122;...
	      2.336198194 2.601165762;...
	      2.309408783 3.194447954;...
	      2.318373328 3.628935147;...
	      2.485575827 2.51010647;...
	      2.646649076 2.219310178;...
	      2.62951671 2.485636658;...
	      2.595976254 2.887137232;...
	      2.595527715 3.200328232;...
	      2.721416271 3.444148593;...
	      2.655139688 4.168847275;...
	      2.757354506 5.234947285;...
	      2.948642866 3.565918177;...
	      3.327774423 2.218584299;...
	      4.078359382 2.375936565;...
	      3.488441932 3.487858214;...
	      3.31230834 3.584972077;...
	      3.246047419 3.710698711;...
	      3.370573404 4.273588573;...
	      3.425109058 4.328024894;...
	      3.341238421 4.404935893;...
	      3.178010131 5.10093377;...
	      3.343210927 5.097850778;...
	      3.169192993 5.37307587;...
	      3.363885914 5.342387994;...
	      3.365105332 5.53812215;...
	      3.248911528 5.601551405;...
	      3.690156995 5.046551306;...
	      3.943140827 6.330855637;...
	      3.980795295 7.426756886;...
	      4.115672953 7.511964606;...
	      4.069264902 7.948786495;...
	      4.031739215 8.156529182;...
	      3.564614112 8.077500022;...
	      3.920227397 8.873706368;...
	      3.901860789 8.93451167;...
	      4.114130813 8.931107981];

length_respi = [...
        1.260883139 0.2233842425;
		1.405191073 0.2056391232;
		1.634466719 0.453598137;
		2.001428365 0.4701286594;
		2.077313292 0.6339746064;
		2.600939524 0.5231470942;
		2.468239107 1.078976795;
		2.72967346  1.311428603;
		2.945740597 1.435386799;
		3.063765331 2.317780428;
		3.170982013 2.446190194;
		3.456354211 2.881249986;
		3.558629058 3.060590838;
		3.70707962  3.210028264;
		3.711213216 3.299708566;
		3.970151101 3.338405283;
		4.057614766 3.793435807];
length_respi_extra = [...
 		2.824651954 2.565837854;
		3.484454814 3.423759803;
        3.915882794 4.686955762;
		3.911796171 5.000287129;
		3.652060369 5.190775791];

age_rep = [...
       21  198.27239;
	   20  168.45439;
	   19  164.81796;
	   18  137.45415;
	   17  129.72740;
	   16  126.27218;
	   15   98.81777;
	   14   98.81777;
	   13   76.09054;
	   12   65.45481;
	   11   65.45481;
	   10   37.09086;
	    9   33.72712;
	    8   25.18230;
	    7   15.09108;
	    6   13.63704;
	    5    0.00000;
	    4    0.00000;
	    3    0.00000;
	    2    0.00000;
	    1    0.00000];

age_length=[...
        0.5381053073 0.9277994912;
	    0.5375515304 0.9649905395;
	    0.5253458374 0.9847180841;
	    1.530684321  1.20006409;
	    1.530017529  1.244845148;
	    1.529644577  1.269892181;
	    1.529124705  1.304806226;
	    2.538712578  1.234767862;
	    2.533073096  1.613509353;
	    2.571287463  1.713719087;
	    2.519194771  1.745569044;
	    3.540491068  1.689199178;
	    3.536068388  1.719557057;
	    3.527686392  1.749153775;
	    3.513506692  2.168117998;
	    3.512071393  2.264511123;
	    4.518739694  2.123883507;
	    4.53394407   2.169432207;
	    4.533345087  2.20965926;
	    4.524861377  2.246086986;
	    7.545476566  2.583211604;
	    7.541053886  2.613569483;
	    7.548475249  2.648487849;
	    7.542805629  3.295917849;
	    9.559095709  3.082974866;
	    9.550736316  3.111053582;
	    9.548566415  3.256781771;
	    11.57899099   3.427904088;
	    11.55857282   3.465843335;
	    11.5461524    3.499991899;
	    11.54939972   3.548570122;
	    14.60222814   3.588940477;
	    14.5935523    3.63827122;
	    14.57708215   3.67773063;
	    14.59237694   3.717207323;
	    14.5798096    3.761222899;
	    16.58298986   3.628727539;
	    16.53846545   3.685628849;
	    16.53791167   3.722819897;
	    16.57230611   4.079571964;
	    18.58925168   3.822606924;
	    18.5886866    3.860556973;
	    18.57225036   3.89773938;
	    18.56366493   3.940998115;
	    18.55832683   4.032835074;
	    21.58857472   3.989702359;
	    21.58796443   4.030688412;
	    21.58669866   4.115696522;
	    21.5702172    4.155914933];

aL1 = [0.5 1.07968304;
       2.5 1.908115044;
       4.5 2.475;
       7.5 3.424402865;
       9.5 3.650166031;
       11.5 4.000100271;
       14.5 4.024254479;
       16.5 4.200629029];

aL2 = [0.5 1.052536891;
       2.5 1.882650553;
       4.5 2.469904757;
       7.5 3.369121527;
       9.5 3.493238667;
       11.5 3.848076589;
       14.5 3.903729304;
       16.5 3.600193173];

aL3 = [0.5 1.055829561;
       2.5 1.804010257;
       4.5 2.387406624;
       7.5 2.913488199;
       9.5 3.204071326;
       11.5 3.427446376;
       14.5 3.476782491;
       16.5 3.478551507];

aL4 = [0.5 1.031976083;
       2.5 1.745083019;
       4.5 2.271092514;
       7.5 2.559077022;
       9.5 2.816197402;
       11.5 2.939749376;
       14.5 2.97469999;
       16.5 3.021434617];

aL5 = [0.5 1.028118246;
       2.5 1.762831836;
       4.5 1.966564473;
       7.5 2.348761915;
       9.5 2.486275515;
       11.5 2.605051257;
       14.5 2.670030657;
      16.5 2.696981579];

%% length at birth and puberty at f; added to stabilise kJ
fL = [1   .8 100;
      .5  .8 100;
      1  2.5 100;
      .5 2.5 100];

%% age at birth at f; added to see if dipause occurs
fab = [1 1.5 10]; % low weight because it gives very high kM and poor fit

%% mean value of v; added to stabilise v but not used due to lack of fit
Cv_obs = [293 .433 0]; % where 293 K has no role

%% less weight to reprod data, because of large numbers
age_rep = age_rep(:,[1 2 2]); age_rep(:,3) = 0.01; 
age_length = [age_length, zeros(49,1)]; % don't use this, different r_B & source

  z = 1; % zoom factor
  p = [z*.540 0; % 1, del
       .799 1; % 2, kap
       .950 0; % 3, kapR
       .1509 1; % 4, g
       3.569 1; % 5, kJ, d^-1
       4.063 1; % 6, kM, d^-1
       z*1.6216 1; % 7, v, mm d^-1 (vol lenth)
       z^2*.00100 1; % 8, UHb, mm^2 d (vol length)
       z^2*.0491 1; % 9, UHp, mm^2 d^-1 (vol length) 
       0.0848/z^3 1; % 10, A, mug h^-1 mm^-3 d; multiply by 24 to remove time
       1.5276/z^2 1; % 11, B, 10^5 cell h^-1 mm^-2
       .8140 0;  % 12, f
       .8804 1;  % 13, f1
       .8087 1;  % 14, f2
       .7328 1;  % 15, f3
       .6216 1;  % 16, f4
       .5593 1]; % 17, f5
  
nmregr_options('max_step_number',5000)
nmregr_options('max_fun_evals',5000) 
%% [p info] =  nmregr('rirl', p, length_respi, length_ing, age_rep, age_length,...
%%		   aL1, aL2, aL3, aL4, aL5, fL, fab, Cv_obs);
%% too unstable for nrregr
[cov, cor, sd] = pregr('rirl', p, length_respi, length_ing, age_rep, ...
		     age_length, aL1, aL2, aL3, aL4, aL5, fL, fab, Cv_obs);
nm = {'del'; 'kap'; 'kapR'; 'g'; 'kJ'; 'kM'; 'v'; 'UHb'; 'UHp'; 'A'; 'B'; ...
      'f';'f1'; 'f2'; 'f3'; 'f4'; 'f5'};
printpar(nm,p,sd); % show results

L = linspace(0,4.5,100)';
a = linspace(0,21,100)';
[respi, ing, rep, Length, L1, L2, L3, L4, L5, Lbp_calc, ab_calc v_calc] = rirl(p(:,1), L, L, a, ...
						     a, a, a, a, a, a, fL, fab, Cv_obs);
                         
nm1 = {'Lb at f = 1'; 'Lb at f = .5'; 'Lp at f = 1'; 'Lp at f = .5'; 'Lm'; ...
    'ab at f = 1'; 'ab at f = .5'; ...
    'UE0 at f = 1'; 'UEb at f = 1'; 'UE0 at f = .5'; 'UEb at f = .5'};
Lm_calc = p(7,1)/ p(4,1)/ p(6,1); % L_m in volumetric length
VHb = p(8,1)/(1 - p(2,1)); vHb = VHb * p(6,1)/ Lm_calc^2;
[UE0 Lb] = initial_scaled_reserve(1,[VHb;p([4 5 6 7],1)]);
[UE05 Lb5] = initial_scaled_reserve(.5,[VHb;p([4 5 6 7],1)]);
UEb = Lb^3/ p(7,1); % Lb^3 f [Em]/{pAm} = Lb^3 f/ v  
UEb5 = .5 * Lb5^3/ p(7,1); % Lb^3 f [Em]/{pAm} = Lb^3 f/ v  
ab = get_tb([p(4,1); p(6,1)/ p(5,1); vHb],1)/p(6,1);
ab5 = get_tb([p(4,1); p(6,1)/ p(5,1); vHb],.5)/p(6,1);
printpar(nm1, [Lbp_calc; Lm_calc/ p(1,1); ab; ab5; UE0; UEb; UE05; UEb5]); % show statistics

%% gset nokey;
%% gset term postscript color solid 'Times-Roman' 35

%% multiplot(2,2)

subplot(2,2,1);
%% gset xtics 1
%% gset ytics 2
%% gset output 'respldaph.ps'
plot(length_respi(:,1), length_respi(:,2),'og', L, respi,'g', ...
    length_respi_extra(:,1), length_respi_extra(:,2),'+r')
xlabel('length, mm');
ylabel('O_2 consumption, mug/h');

		    
subplot(2,2,2);
%% gset xtics 1
%% gset ytics 2
%% gset output 'ildaph.ps'
plot(length_ing(:,1), length_ing(:,2), 'og', L, ing, 'g');
xlabel('length, mm');
ylabel('ingestion rate, 10^5 cells/h');

subplot(2,2,3);
%% gset xtics 5
%% gset ytics 50
%% gset output 'repdaph.ps'
plot(age_rep(:,1), age_rep(:,2),'og', a, rep, 'g')
xlabel('time since birth, d');
ylabel('cum # of young');

subplot(2,2,4);
%% gset xtics 5
%% gset ytics 1
%% gset output 'ladaph.ps'
plot(... % age_length(:,1), age_length(:,2),'og', a, Length, 'g',...
     aL1(:,1), aL1(:,2),'ok', a, L1, 'k',...
     aL2(:,1), aL2(:,2),'or', a, L2, 'r',...
     aL3(:,1), aL3(:,2),'om', a, L3, 'm',...
     aL4(:,1), aL4(:,2),'og', a, L4, 'g',...
     aL5(:,1), aL5(:,2),'ob', a, L5, 'b') 
xlabel('time since birth, d');
ylabel('length, mm');

%% multiplot(0,0)
