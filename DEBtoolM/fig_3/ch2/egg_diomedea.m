%% fig:egg_diomedea
%% bib:PettGran82
%% out:PettGran82,PettGran82r
%%  run this script from egg
%% Diomedea immutabilis: wet weight and dioxygen consumption at age

aW = [31.42380386 13.13627684;
      33.82025623 15.8144908;
      36.98427518 20.22454448;
      37.36425433 16.34867765;
      37.56247327 24.66848687;
      38.9519312  25.61799895;
      39.71810034 25.60795784;
      40.58469876 31.40293102;
      40.77981227 35.85189397;
      40.78167552 38.17440173;
      41.49964855 37.77790357;
      41.93993495 49.38479428;
      41.9417982  51.70730205;
      42.8932988  43.95305812;
      43.7668844  58.45743542;
      43.90805678 55.35887569;
      43.9148887  63.8747375;
      46.02666724 69.84693621;
      46.03194646 76.42737488;
      46.84134304 70.61043679;
      47.60813327 71.37456495;
      48.71509117 78.32765416;
      51.50891303 98.80674044;
      52.09192452 109.2504946;
      52.27896395 103.6352572;
      52.46507175 96.85876593;
      52.95464116 110.2069099;
      53.00687432 115.6254671;
      53.09193177 102.2697923;
      53.22999873 95.30038632;
      54.34751505 115.4143529;
      54.83211579 122.5691428;
      54.90972023 99.92343694;
      54.93192397 127.5999878;
      54.96086649 103.987198;
      56.90439339 138.993254;
      58.1576476  149.2346799;
      58.2763057  118.0724846;
      58.72373456 138.5823218;
      58.77891787 147.678183;
      58.82494019 145.3550476;
      58.87826024 152.128401;
      59.01399814 142.2558603;
      59.696352   157.1498325;
      59.84373521 161.7929654;
      59.87298828 138.5672601;
      61.24483846 177.258151];

aO2 = [13.96603612 58.49714112;
       16.0530217  37.41169021;
       16.09231112 59.88458629;
       16.8977035  94.08101222;
       16.90543912 64.90462346;
       16.91436482 31.23955951;
       18.49538091 41.25011374;
       19.02933393 75.26941902;
       19.03825964 41.60435506;
       19.8043626  53.32788492;
       19.85436287 35.40270425;
       20.01449579 114.0726006;
       20.64844935 112.2415445;
       20.66094534 65.11045499;
       21.03000506 38.41456471;
       21.46752781 94.81820573;
       21.65443786 72.4929102;
       21.95386075 137.7853413;
       22.14136584 113.2157082;
       22.95568393 113.7470701;
       23.37295877 75.85901198;
       24.00334205 87.4939815;
       24.22180591 116.8179708;
       24.27597151 83.18242697;
       24.28549226 47.27302542;
       24.94028878 137.4893309;
       24.99445438 103.8537871;
       25.00219    74.67739834;
       25.1004054  45.5600498;
       25.82186351 55.00972195;
       25.84627675 133.591058;
       25.85639255 95.4373188;
       25.86174798 75.23828043;
       26.01890567 165.1298647;
       26.81773622 53.41482677;
       27.09871264 188.2817234;
       27.29097811 145.7573895;
       27.29930877 114.3366631;
       27.30763943 82.91593674;
       27.73861667 164.0072913;
       27.81122874 60.79728198;
       29.13688805 180.6327779;
       29.14700385 142.4790388;
       29.8172716  174.3425668;
       30.18811645 140.9136637;
       30.88099599 87.49236303;
       31.04767443 141.4745458;
       31.81794272 137.4877125;
       31.82567833 108.3113237;
       31.87805879 81.40879265;
       32.45011114 142.3896692;
       32.86264192 293.0554893;
       32.97216321 221.2957264;
       33.02632881 187.6601826;
       33.03227928 165.2168066;
       33.49062869 143.0686317;
       33.9210272  397.0035014;
       34.03233364 318.5107257;
       34.04183808 112.0021467;
       34.04542467 269.1352986;
       34.0608959  210.7825211;
       34.99247089 110.3777314;
       35.02878508 144.0723155;
       35.30381104 301.382588;
       35.37582805 200.4169163;
       35.41929912 377.7786267;
       35.88181385 339.9200886;
       35.92465725 178.3277816;
       36.80327305 277.6690381;
       36.92173636 342.8433887;
       37.93132778 630.8270838;
       37.93427039 278.4070408;
       37.98666716 422.1036873;
       38.01225419 325.5971706;
       38.7688527  543.8292795;
       39.0069368  328.4909506;
       39.06526773 279.1450436;
       40.1635538  573.9207917;
       40.20937242 401.1067967;
       41.80349586 532.3411013;
       41.94756252 671.6081127;
       42.81961649 625.0379053;
       43.19880832 730.7874533;
       43.7351089  414.6310532;
       43.74823256 706.4539811;
       43.98753938 827.825332;
       44.00658088 756.0065289;
       45.2595792  467.2545017;
       46.0322603  795.488673;
       46.04773153 737.1358954;
       46.05844237 696.7378187;
       47.00672762 1045.289109;
       47.62519365 931.2116527;
       48.34903195 931.6839745;
       49.25267235 1277.961407;
       50.27831373 1334.748809;
       50.49319099 1206.939647;
       51.28430224 1295.000175;
       51.29736065 904.4263929;
       51.50155969 1158.213662;
       51.52357643 1075.173171;
       51.53607242 1028.042081;
       51.64385751 1474.812864;
       52.10934748 1425.732638;
       52.38850615 1226.134192;
       52.52062292 898.4904231;
       53.06412932 1237.798682;
       53.07424512 1199.644943;
       53.33375091 903.5104602;
       53.89271222 1013.866764;
       54.08380391 1146.430283;
       54.20226722 1211.604633;
       54.75468302 1346.648651;
       56.49583203 1435.329101;
       56.87381745 1374.968147;
       57.01009956 1031.614015;
       57.21844761 1099.091743;
       57.60180477 1189.130928;
       57.6661188  1458.54;
       57.72089576 1593.259296;
       58.15539434 1149.087093;
       58.42860254 971.932023;
       58.56499882 1822.772133];

%% we must have decreasing times for embryo-data fitting
aW = aW(47:-1:1,:); aO2 = aO2(123:-1:1,:);
aO2(:,2) = 0.001 * aO2(:,2); % avoid big numbers for numerical stability

nrregr_options('report',0)
aO2= [aO2, .001+0*aO2(:,1)];
p = [62.5 0; 1 0; .1 0; 163460 0; .01 0; 0.82 0; 488 1; 166 1];
p = nrregr('embryoVO',p, aW, aO2);
[cov cor sd ssd] = pregr('embryoVO',p, aW, aO2);
printpar(nmVO, p, sd); 
nrregr_options('report',1)

a = linspace(62.5,0,100)';
[W O2] = embryoVO(p(:,1), a, a);
%% [eW eO2] = embryoVO(p(:,1), aW, aO2);
%% [aO2 eO2]

%% gset term postscript color solid 'Times-Roman' 35
%% clg; gset nokey

%% multiplot(1,2)
subplot(1,2,1);
%% gset output 'PettGran82.ps'
plot(aW(:,1), aW(:,2), 'og', a, W, 'r');
title('Diomedea immutabilis')
xlabel('time, d');
ylabel('wet weight structure, g');

subplot(1,2,2);
%% gset output 'PettGran82r.ps'
plot(aO2(:,1), aO2(:,2), 'og', a, O2, 'r');
title('Diomedea immutabilis')
xlabel('time, d');
ylabel('O2 consumption, l/d');

%% multiplot(0,0)
