%% fig:WeinWalf86
%% bib:WeinWalf86,LeeuKelp2002, see HubeLaro2000, ch4
%% out:WeinWalf86_W,WeinWalf86_S

tS100 = [ ...
2.9812175515872585   99.73307202577274;
6.455895984392862    97.69141545992184;
9.512486015128768    95.66240157777212;
13.893788344201628   93.76968277306717;
18.48160566484727    91.34231941819203;
20.285702720495824   89.70322628947888;
22.08807982567813    87.71213887750436;
22.288860969806112   85.94517543831446;
22.62647012055574    83.64633523139112;
24.149329792247592   81.48734682318302;
24.211360114338483   79.90159300217542;
24.479171461153154   77.60420292954846;
25.01589721505645    75.47536714397613;
25.02673863324448    73.18706382424402;
25.28621163100544    71.41799775040081;
25.972845346738808   69.28495669552186;
26.451450114218748   67.33389917883999;
26.711184515257234   65.21072670151226;
26.78989153545555    63.27652188062312;
26.978998990908327   60.97979221299464;
27.318846678678337   59.208623504498135;
27.449262280498136   57.26809497036592;
27.718744425959972   55.32336116692714;
28.335009470548737   53.01609461210741;
28.533863106006653   50.897473415868646;
28.85395828202343    48.774565100540286;
28.872305778778017   46.83614710570296;
28.932926705499266   44.901950189455405;
29.40209600844076    42.94872399762038;
29.86902489706001    40.645604576249;
29.879032793226312   38.53323314811186;
29.928811675992247   36.41875118067986;
30.198293821454083   34.47401737724107;
30.397408547305883   32.35532223586088;
30.668558362578455   30.76258429661176;
30.79704457842635    28.470001762431604;
31.205854670807742   26.521054785044615;
31.266475284645356   24.58257074970746;
31.454486876147957   22.11182160827931;
31.46366062452525    20.17551415273687;
31.65443574978877    18.23288298395138;
31.78375580054203    16.116298381866073;
32.19199314841194    13.991279527242842;
32.391680618775226   12.048656263098902;
32.87195305606592    10.449594610606717;
33.76603953382114    7.957771694796104;
34.66179399427077    5.818010683675016;
34.72408290368641    4.231654593527221;
35.54003479287117    1.7419422170114771;
35.5483747063431     0.018367306436127606];

tS75 = [...
3.050907665374792    99.73096464833449;
17.886217326475162   98.05052409241625;
19.479599382441705   96.0650960363655;
19.820494720993743   94.47090954374828;
22.04189706004392    92.64284401581158;
22.244087599541537   91.22854475045138;
25.998384898312192   89.35412561397895;
28.15085410191516    87.70449796946701;
28.976241768522033   85.39090770140423;
29.45708820185877    83.96818208814767;
29.518541399067185   82.20543182290598;
29.718490272708      80.26280065412048;
30.336996983153565   78.48386600272606;
30.4690802547841     76.89533333278354;
31.157378511491796   75.11362773709581;
31.49665533205216    73.16678339436213;
31.549508776929347   71.40470143876045;
31.55785025481948    69.6440617128136;
31.610965102974173   67.88197185257037;
31.663818547851353   66.29555762656429;
31.672992296228646   64.35925017102183;
31.787560341591753   62.77071750107933;
31.795901819481887   61.0100777751325;
32.47669399762303    59.404700314038806;
32.53731492434429    57.46628231920151;
32.66913679269729    55.87775755390054;
33.07044237093035    54.10513871110763;
33.078782284402266   52.344829187660025;
33.26288516600461    50.4021319783747;
33.27039093168753    48.817886427521756;
33.38469913819132    47.05336373012598;
33.39387319945226    45.11699023408369;
33.51652131942798    43.52853150928259;
33.926165246714746   41.75558246399042;
34.12778210304995    40.16501319989446;
34.186473330915646   37.874475164509334;
34.24792840542591    36.1121211422667;
34.93873004415157    34.85880558586254;
35.34780153981049    32.909850703833996;
35.618951355083055   31.317112764584866;
35.671805112843884   29.202638701794424;
35.678476730737785   27.794457123536194;
36.15040956744018    25.843333566354485;
36.419891712902015   23.898599762915676;
36.55280913232157    22.486131065567857;
36.61400249067067    20.723718907466935;
36.67295543469753    18.433239007940106;
36.73665061064638    17.198886686623545;
37.007800738802615   15.606214787874254;
37.208583447348786   13.8395815511836;
37.40019240751769    12.07294831449294;
37.409366155894986   10.136640858950496;
38.36714812248272    8.346839117865617; 
38.56959881372329    6.932267785864479;
38.701420682076304   5.343743020563526;
39.530144001188305   3.734210521379957;
40.148076715587806   1.7789398307499145;
42.22908326139783    0.22063917915667197];

tS44 = [...
18.096903056993      98.39619940521948;
22.410936791592984   97.03325394313052;
24.98248350971932    95.54664660172809;
25.114305378072338   93.95812183642713;
25.943602380346746   92.52485933597934;
29.980726311901602   91.52233371458397;
31.15706761658046    89.72653055811371;
31.359255027241655   88.31157088775502;
31.98052621009906    87.06095233050281;
32.741954481526776   85.98112792389955;
32.87294407939264    84.21693542900299;
34.539302436949114   82.93405370982016;
35.29656309826818    80.97456984524192;
35.571309656439766   80.08581572973058;
35.632504579207065   78.3237337741289;
37.29969520725071    77.21651978454165;
37.57110642580081    75.62377394065095;
37.774132364622005   74.38580280988485;
37.84309164039696    74.20736413599592;
38.394565019319415   72.95819571304008;
38.73550950969053    71.36334723449609;
39.00249171485447    70.47526142862476;
39.00999779342102    68.89094983727199;
39.0664479811972     67.65652357081404;
39.61541829098533    65.87903114907445;
39.67770688751732    64.29260901842683;
39.80452574643812    63.23030561725632;
39.88156509682568    61.648096660556845;
40.28563358305237    60.22536314265875;
41.533746696572635   58.95512884996201;
41.593532223970314   56.84038272053061;
41.72702176213406    55.60385381941934;
41.86051442913423    54.36798532330654;
42.06296324307296    52.95301774830632;
43.79911752726255    51.668289651828005;
44.00214065013097    50.42972415656325;
44.552208075403826   48.82861800527604;
45.17180845961407    47.22534317883567;
45.442124439981285   45.45660730749171;
45.71494255083188    44.21599731343194;
46.47804099513948    43.48869709501713;
46.67965785147469    41.89812783092114;
46.81064588492232    40.133605133525364;
47.15132897201592    38.538764559622905;
47.28508053922448    37.302359834869776;
47.5562306673807     35.709687936120474;
47.61909200842419    34.299337682709094;
47.682214752745196   32.888979524656136;
47.746744076483054   31.830691175934252;
48.22618267886838    30.05563159134724;
48.283467640200854   27.76515169182041;
48.28513562289524    27.413089787130883;
48.555451603262455   25.996415820476432;
48.68894145430984    24.759952959865007;
48.8207636355465     23.1714942350639;
49.14919841215155    20.34235947570318;
49.210391770500664   18.936214491598413;
49.22540361475011    17.17380233349749;
49.26767673183315    15.76344417544454;
49.27351451482167    14.531260529281138;
49.402000730669556   13.470861641264396;
49.46345549229618    11.70844157852192;
49.94680280458175    10.813577680550175;
50.35837611784042    9.392682635305995;
50.559731258014466   7.802055235351723;
50.69264867743401    6.389586538003908;
51.033332077411245   4.794812004601301;
51.303648057778446   3.026076133257332;
51.370106767488224   2.3198417845834207;
51.850379517662546   0.7208461725910826;
52.194659973422446   0.16987849657387777];

tS35 = [
19.6782173146369     98.61317997110231;
29.553245242758557   96.4217398287714;
31.008972884847843   94.97596436060411;
34.06508739630721    93.31253516772;
36.42483390481877    91.66707535033616;
36.76720561562204    90.24936887930453;
36.96970227929498    88.66023616434133;
37.31039311617074    86.89052025373104;
38.904131253502776   85.08913069060729;
40.08080936255555    83.47419927232049;
40.42247252094198    81.88081493421737;
40.90259362162507    80.10750110590286;
41.66176425534468    78.5033432277079;
42.27537544021387    75.31837351035377;
42.282476946767616   77.07911483972433;
42.407445755835404   73.5547014440619;
42.67868256617045    71.78677775463011;
42.736328333409816   68.79251106757923;
42.74200740766809    70.20057577658824;
43.14744551833697    67.19733450829762;
43.342840675456166   63.84746046396385;
43.417973776255174   65.25373295179433;
43.60768719538519    60.49513375534229;
43.68353151233193    62.07774455335356;
43.80308235250438    57.14525971100853;
43.80947264291039    58.72966273019829;
43.8661460886391     55.559064470640244;
44.207098030877795   53.789341822356356;
45.73183092058845    52.16575930671085;
46.35112251158137    50.38918451992038;
46.48390137961976    48.80119032069998;
47.45479663993582    47.89587279105959;
47.51644034113288    45.957595329128125;
47.55988495987638    39.442308293512625;
47.573375424970685   42.787122420518315;
47.58047559965898    44.54753352833421;
47.62365884666648    38.032187186081394;
47.63643916110541    41.20092718015003;
47.68556391959956    36.09396903078726;
47.88779708055175    34.50424865469929;
47.950412037767116   32.74203858803127;
48.43195450525331    31.3211372028346;
48.70177261251613    29.20146151339428;
49.87774083728663    27.41052200648135;
50.2172740764531     25.289047358188924;
50.420478227050516   23.875328333053467;
50.76285153609233    22.458018127887406;
51.03266990972824    20.33840848275802;
51.16473889348434    18.574406194911504;
51.4366869199671     16.982820815660496;
51.91751950317101    15.385911341837689;
51.98058323930572    13.799716101469402;
52.390541761031244   11.85251662726193;
52.523320895442716   10.26458847235246;
52.58496459663977    8.326311010420996;
52.647579553855145   6.564100943752981;
53.26758129550344    4.963600289899558;
53.32993514735587    3.2013969609051536;
53.39255010457124    1.439186894237137;
54.64107353112071    0.3506128715984591];

tW100 = [ ...
0.79915446	19.14396489;
1.03280372	21.94552210;
1.86360787	25.21400737;
3.04721358	31.51750828;
4.58873969	38.28793726;
6.73300689	42.72373524;
8.52679973	42.95719740;
10.91635019	44.35797601;
14.26097882	46.69260701;
17.23837737	53.22957196;
22.27207509	48.32684778;
25.85919341	49.02723615;
27.77213853	49.49416235];

tW75 = [...
0.56643656	15.87548335;
1.03745809	19.61089296;
2.58038050	25.68093171;
3.29482594	27.31517434;
4.48680951	29.41634131;
6.63433382	32.21789852;
7.82864457	33.15175092;
9.14117579	34.78598982;
11.17373768	35.25291789;
14.87907838	36.65369462;
17.26258008	41.08949447;
22.89203639	37.35408486;
26.36047073	37.58754703;
28.39535789	36.88716053;
31.02647291	37.12062270;
33.30013202	36.65369462;
35.45603418	35.25291789];

tW44 = [ ...
0.81311757	12.14007375;
0.81777193	9.80544835;
1.40841071	13.54085422;
2.72187376	14.70816879;
5.22638854	18.44357839;
7.01971595	18.91050273;
8.69528736	18.44357839;
10.36853160	19.14396489;
12.28287303	18.91050273;
13.83603506	19.84435513;
15.38780077	21.47859777;
17.54277398	20.54474536;
22.44568252	21.24513560;
27.47100047	20.54474536;
30.93710762	21.94552210;
32.97106775	21.71205993;
35.12464272	21.47859777;
38.71316119	21.47859777;
40.98914364	19.84435513;
42.66192436	20.77820753;
45.89019427	21.47859777];

tW35 = [
0.5328073999818637   11.975705027309946;
1.5033634588772617   11.483012758697658;
1.912962408731036    12.622148749123372;
3.2149326895565116   14.00219532863984;
4.353558371025801    15.056978999581403;
5.485842703703441    14.482166271767227;
7.1850463163876315   13.823638986087524;
8.72851487537374     14.795345738629006;
10.759163759107256   16.009557178924904;
12.78600793075493    16.24603575558173;
17.41137150490734    17.857460040337667;
24.15511188451011    22.39391860318487;
27.87859198301692    21.320006481198476;
31.846927328795683   20.652551998696044;
34.19609051452766    20.480341564199268;
35.73581633818001    20.47428398927741;
38.98336865717783    22.009644656834393;
42.70415040647328    20.202416666593944;
45.86718335863791    20.923299176037332];

%% MacdAlle27 foetal growth
tWF = [18 1.1899996;
       17 0.8466994;
       16 0.5926020;
       15 0.3650994;
       14 0.2287995;
       13 0.1297981;
       12 0.0761993;
       11 0.0329006;
       10 0.0085998];

tS100(:,1) = 30 * tS100(:,1); % convert months to days
tS75(:,1) = 30 * tS75(:,1); % convert months to days
tS44(:,1) = 30 * tS44(:,1); % convert months to days
tS35(:,1) = 30 * tS35(:,1); % convert months to days
tS100(:,2) = .01 * tS100(:,2); % convert perc to prob
tS75(:,2) = .01 * tS75(:,2);
tS44(:,2) = .01 * tS44(:,2);
tS35(:,2) = .01 * tS35(:,2);

%% more weight to survival data
tS100 = [tS100, 0 * (1+ 0 * tS100(:,1))]; tS100(1:12,3) = 0;
tS75 = [tS75, 0 * (1+ 0 * tS75(:,1))];
tS44 = [tS44, 0 * (1+ 0 * tS44(:,1))];
tS35 = [tS35, 0 * (1+ 0 * tS35(:,1))];

tW100(:,1) = 30 * tW100(:,1); % convert months to days
tW75(:,1) = 30 * tW75(:,1); % convert months to days
tW44(:,1) = 30 * tW44(:,1); % convert months to days
tW35(:,1) = 30 * tW35(:,1); % convert months to days
tW100 = [tW100, 1./tW100(:,2)]; tW100(10,3) = 0;
tW75 = [tW75, 1./tW75(:,2)]; tW75(11,3) = 0;
tW44 = [tW44, 10./tW44(:,2)];
tW35 = [tW35, 1./tW35(:,2)];

%% even more weight to foetal data
tWF = [tWF, 500./tWF(:,2)];

nmregr_options('max_step_number',2000);
nmregr_options('max_fun_evals',2000);
nmregr_options('report',1);

h0 = 0;
ha = .003; %% is multiplied by 1e-6 in dweib_gomp
sG = .1;
V0 = 6.8053;
w = 0.6811; % -, contribution of reserve to weight
v = .2784;
kM = .0065;
LT = 0;
g = 13.5993;
t0 = 8.1920; % d, start of foetal development 
%% pack parameters
p = [h0 0; ha 0; sG 0; V0 1; w 1; v 1; kM 1; LT 0; g 1; t0 1];

if 0
p = nmregr('weib_gomp', p, ...
	   tS100, tS75, tS44, tW100, tW75, tW44, tWF);
par_txt = {'h0'; 'ha'; 'sG'; 'V0'; 'w'; 'v'; 'kM'; 'LT'; 'g'; 't0'};
[cov cor sd] = pregr('weib_gomp', p, ...
		     tS100, tS75, tS44, tW100, tW75, tW44, tWF);
printpar(par_txt,p,sd);
end

t = linspace(0, 30 * 55, 100)';
tF = linspace(0,18.5,100)';
[S100, S75, S44, W100, W75, W44, WF] = ...
    weib_gomp(p(:,1), t, t, t, t, t, t, tF);

%% e and L trajectories
%% rB = kM/ 3/ (1 + 1/ g); Lm = v/ kM/ g;
%% L = 1 - (1 - V0^(1/3)/ Lm) * exp(- rB * t);

%% gset term postscript color solid 'Times-Roman' 35

subplot(1,3,1)
%% gset output 'WeinWalf86_S.ps'
plot(tS100(:,1), tS100(:,2), 'or', t, S100, '-r', ...
     tS75(:,1), tS75(:,2), 'og', t, S75, '-g', ...
     tS44(:,1), tS44(:,2), 'ob', t, S44, '-b')

subplot(1,3,2)
%% gset output 'WeinWalf86_W.ps'
plot(tW100(:,1), tW100(:,2), 'or', t, W100, '-r', ...
     tW75(:,1), tW75(:,2), 'og', t, W75, '-g', ...
     tW44(:,1), tW44(:,2), 'ob', t, W44, '-b')

subplot(1,3,3)
%% gset output 'MacdAlle27.ps'
plot(tWF(:,1), tWF(:,2), 'or', tF, WF, '-r')
