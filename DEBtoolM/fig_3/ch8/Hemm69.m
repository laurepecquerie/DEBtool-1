%% fig:Hemm69
%% bib:EckeRand88,Hemm69
%% out:Hemm69

%% log body weight in g, log metabolic rate in Watts

%% unicellulars at 20C
wr1=[ -4.1205   -6.8823;
   -4.2455   -6.9212;
   -4.1835   -7.2198;
   -4.3723   -7.2188;
   -4.5355   -7.4135;
   -4.5621   -8.0227;
   -5.0390   -7.6851;
   -5.1393   -7.8919;
   -5.3281   -8.0865;
   -5.3154   -7.8658;
   -5.4029   -7.7361;
   -5.5543   -8.1115;
   -6.1827   -8.0457;
   -6.2958   -7.9287;
   -6.3588   -8.0706;
   -6.2712   -8.4600;
   -6.1955   -8.3571;
   -6.2831   -8.2144;
   -6.3971   -8.3821;
   -6.4099   -8.4730;
   -6.0077   -8.5519;
   -6.0952   -8.3961;
   -6.1581   -8.5389;
   -6.1709   -8.6168;
   -6.2220   -8.6947;
   -6.3981   -8.8105;
   -6.5102   -8.7456;
   -6.5603   -8.6288;
   -6.6606   -8.5379;
   -6.7246   -8.7446;
   -6.6242   -8.8754;
   -6.7619   -8.9003;
   -6.6999   -9.0432;
   -5.9458   -9.0712;
   -6.0844   -8.9803;
   -6.3489   -9.4076;
   -6.3233   -9.2518;
   -6.4738   -9.2649;
   -6.4748   -9.4336;
   -6.7511   -9.4975;
   -7.5801   -9.4696;
   -6.9508   -8.9783;
   -6.8504   -9.2768;
   -6.9763   -9.4326;
   -7.6539   -8.7296;
   -7.7424   -9.1321;
   -7.7680   -9.3528;
   -7.9312   -9.3127;
   -8.0443   -9.5075;
   -6.9153   -9.9129;
   -7.0658   -9.7691;
   -7.2035   -9.8081;
   -7.3166   -9.9768;
   -8.3865  -10.5970;
   -8.3619  -11.2070;
  -10.0317  -10.5799;
   -9.7563  -11.0742;
  -10.4615  -12.1756;
  -10.4624  -12.3574;
  -11.6690  -12.7308;
  -11.9089  -13.3919;
  -12.1962  -12.6000;
  -12.1833  -12.7429;
  -12.2345  -13.1712;
  -12.2857  -13.2611;
  -12.2482  -13.3519;
  -12.2610  -13.4818;
  -12.4872  -13.7414;
  -12.1991  -13.8063];
%% ectotherms at 20 C
wr2 = [ ...
   4.26091   0.41815;
   3.90881   0.28936;
   2.58714  -0.83706;
   2.44946  -0.72024;
   1.06489  -2.20909;
   0.97738  -1.92346;
   0.48666  -2.22106;
  -0.36890  -2.84211;
  -0.70819  -3.06186;
  -1.22447  -3.55307;
  -1.22447  -3.87766;
  -1.53914  -4.08535;
  -1.62665  -3.92860;
  -1.76535  -4.00645;
  -1.84107  -4.24009;
  -2.02986  -4.23913;
  -2.49503  -4.57561;
  -2.35830  -5.21169;
  -2.49597  -4.88718;
  -2.58452  -5.13384;
  -3.01131  -5.39246;
  -3.16275  -5.43038;
  -3.35059  -5.41745;
  -3.72919  -5.97463;
  -4.14316  -5.99953;
  -4.18051  -5.79185;
  -4.68500  -6.76449;
  -5.26323  -7.07406;
  -5.65362  -7.56632];

wr2 = [wr2, [ones(23,1);zeros(6,1)]]; %% weights for data points
%% endotherms at 39 C
wr3 = [ ...
   6.02504   3.46374;
   5.50979   3.15321;
   5.27084   2.89459;
   4.25205   2.23457;
   4.54013   2.13068;
   3.76030   1.62644;
   3.05626   0.93943;
   2.80449   1.01832;
   2.71595   0.81055;
   2.48982   0.56494;
   1.79843   0.21545;
   1.55854  -0.18595;
   0.91732  -0.49551;
   0.69119  -0.66432];

%% plot(wr1(:,1),wr1(:,2),"bo",wr2(:,1),wr2(:,2),"go",wr3(:,1),wr3(:,2),"ro");
%% Fit ectotherm data to DEB model

%% unicellulars
p1 = [50; 8.9]; p1 = nrregr('respi', p1, wr1(:,[2 1]));
r1 = linspace(-14,-6.5,100)'; w1 = respi(p1(:,1),r1);

%% ectotherms
p2 = [90 1; 8.9 1]; %% insert zero in second column to fix par value
p2 = nrregr('respi', p2, wr2(:,[2 1 3]));
[cov cor sd] = pregr('respi', p2, wr2(:,[2 1 3]));
r2 = linspace(-8.5,1,100)'; w2 = respi(p2(:,1),r2);

%% [p2, sd]

%% endotherms
p3 = [25; 8.9]; p3 = nrregr('respi', p3, wr3(:,[2 1]));
r3 = linspace(-1.5,4,100)'; w3 = respi(p3(:,1),r3);

%% relationship wet weight - structural weight for ectotherms
%% suppose d_V = 1 g/cm^3
%% give [p_M] in Watts.cm^-3 , w_E [M_Em] V_m^{-1/3} in g.cm^-4
p = p2(:,1); pW = p(2)/p(1)^(4/3);

%% [1/p(1) pW]

%% gset term postscript color solid 'Times-Roman' 35

subplot(1,2,1)
%% gset output 'Hemm69.ps'
plot(wr1(:,1), wr1(:,2), '.b', ...
    wr2(:,1), wr2(:,2), '.g', ...
    wr3(:,1), wr3(:,2), '.r', ...
    w1, r1, 'b', ...
    w2, r2, 'g', ...
    w3, r3, 'r')
legend('unicellulars, 20C','ectotherms, 20 C', 'endotherms, 39 C')
ylabel('log respiration, Watt')
xlabel('log body weight, g')

subplot(1,2,2)
%% gset output 'Hemm69a.ps'
W = 10*(0.01:100); % total body wet weight
[WV WE] = structure(W, pW); % get structural and reserve weights
plot(W, WV, 'g')
xlabel('wet weight')
ylabel('structural weight')

